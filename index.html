<!DOCTYPE html>
<html>

  <head>
    <meta charset='utf-8'>
    <meta http-equiv="X-UA-Compatible" content="chrome=1">
    <meta name="description" content="RFTM : ">

    <link rel="stylesheet" type="text/css" media="screen" href="stylesheets/stylesheet.css">

    <title>RFTM</title>
  </head>

  <body>

    <!-- HEADER -->
    <div id="header_wrap" class="outer">
        <header class="inner">
          <a id="forkme_banner" href="https://github.com/nccgroup/RFTM">View on GitHub</a>

          <h1 id="project_title">RFTM</h1>
          <h2 id="project_tagline"></h2>

            <section id="downloads">
              <a class="zip_download_link" href="https://github.com/nccgroup/RFTM/zipball/master">Download this project as a .zip file</a>
              <a class="tar_download_link" href="https://github.com/nccgroup/RFTM/tarball/master">Download this project as a tar.gz file</a>
            </section>
        </header>
    </div>

    <!-- MAIN CONTENT -->
    <div id="main_content_wrap" class="outer">
      <section id="main_content" class="inner">
        <p>The RFTM is an Open Source, collaborative testing methodology that can be applied to all Radio Frequency (wireless) technologies. Throughout this methodology, we'll use various real-world wireless protocol examples</p>

<p><a href="basics.html">Signals and Modulation</a></p>

<p><a href="information_sources.html">Information Sources</a></p>

<p><a href="receiving_signals.html">Receiving Signals</a></p>

<p><a href="fsk_receiver.html">Developing an FSK receiver step-by-step</a></p>

<h2>
<a id="developing-a-digital-ask-receiver-step-by-step" class="anchor" href="#developing-a-digital-ask-receiver-step-by-step" aria-hidden="true"><span class="octicon octicon-link"></span></a>Developing a digital (ASK) receiver step-by-step</h2>

<h3>
<a id="configure-the-gnu-radio-environment" class="anchor" href="#configure-the-gnu-radio-environment" aria-hidden="true"><span class="octicon octicon-link"></span></a>Configure the GNU Radio environment</h3>

<p>Follow the steps in the FSK receiver example up to the point of receiving the baseband signal. In our case the signal (from an Audi A4 keyfob) is at 433.920MHz:</p>

<p><img src="images/ask_baseband.png" alt=""></p>

<h3>
<a id="signal-visualization-and-identification" class="anchor" href="#signal-visualization-and-identification" aria-hidden="true"><span class="octicon octicon-link"></span></a>Signal visualization and identification</h3>

<p>Open the file in Baudline (see FSK receiver for details of how to do this):</p>

<p><img src="images/ask_baudline.png" alt=""></p>

<p>You can see at the beginning of the data burst (the preamble), the signal alternates between a large amplitude and zero down the screen (time axis). This clearly shows that the signal has been modulated using Amplitude Shift Keying (ASK), which is also known as On-Off Keying (OOK).</p>

<h3>
<a id="filtering" class="anchor" href="#filtering" aria-hidden="true"><span class="octicon octicon-link"></span></a>Filtering</h3>

<p>We now want to focus in on the signal of interest and filter out any other signals present in the baseband we have recorded. Add a "Low Pass Filter" block between the "Multiply" block output and the "WX GUI FFT Sink" input.</p>

<ul>
<li>  Set "Cutoff Freq" to 150e3 - this is the maximum frequency (of the modulated signal) that we want to display</li>
</ul>



<ul>
<li>  Set "Transition Width" to 50e3 - this is the bandwidth over which the filter will act i.e. the smaller the number the more aggressive the filter.</li>
</ul>

<p>Restart the flow-graph and you should see something like this:</p>

<p><img src="images/grc_filtered_signal.png" alt=""></p>

<h3>
<a id="demodulating" class="anchor" href="#demodulating" aria-hidden="true"><span class="octicon octicon-link"></span></a>Demodulating</h3>

<p>We are making the assumption that based on the output we observed in Baudline, the modulation scheme is ASK (to be precise, "2-ASK" or "Binary ASK" where the amplitude is increased for a "1" and remains low for a "0"). Therefore, we need to add an ASK demodulator - "AM Demod) Add a "Quadrature Demod" and set the "Gain" to be 1.</p>

<p>Add a "File Sink" and set its input type to be "float" (orange coloured) and set the filename to be something like "4M_filtered_demod"</p>

<p>Connect the output of the "Low Pass Filter" to the input of the "AM Demod"</p>

<p>Set the following "AM Demod" settings:</p>

<ul>
<li>  "Channel Rate": 48e3</li>
</ul>



<ul>
<li>  "Audio Decimation": 1</li>
</ul>

<p>Connect the output of the "AM Demod" to the input of the "File Sink"</p>

<p>In "File Source" set "Repeat to "No"</p>

<p>Your flow-graph should now look like this:</p>

<p><img src="images/ask_flow_demod.png" alt=""></p>

<p>Run the flow-graph and it will produce a file that hopefully will contain demodulated data.</p>

<h3>
<a id="visualising-the-data" class="anchor" href="#visualising-the-data" aria-hidden="true"><span class="octicon octicon-link"></span></a>Visualising the data</h3>

<p>We should now have a demodulated file that can be loaded into Baudline.</p>

<p><strong>Note: Remember, if your "4M_filtered_demod" file is larger than 50Mb then you will need to split it into chunks again.</strong></p>

<p>Start Baudline and load your demod file - use all the same parameters as before, but this time change "Channels" to 1 (it is no longer a complex baseband signal - it is a demodulated signal). Click "Open" and it should look something like this:</p>

<p><img src="images/ask_demod2.png" alt=""></p>

<p>Ensure that the separate "Waveform" window is open (main menu -&gt; displays -&gt; waveform)</p>

<p><img src="images/ask_demod1.png" alt=""></p>

<p>These are the data bits represented by the original complex baseband signal we saw in Baudline. It also confirms that the data was modulated using 2-ASK.</p>

<h3>
<a id="further-filtering-and-clock-recovery" class="anchor" href="#further-filtering-and-clock-recovery" aria-hidden="true"><span class="octicon octicon-link"></span></a>Further filtering and clock recovery</h3>

<p>If we look at the signal with respect to the scale, we can see that by choosing a peak, it's approximately 3.6 bits per millisecond, so it looks like 3600 Baud.</p>

<p><img src="images/ask_demod3.png" alt=""></p>

<p>Ok, now we think we have the Baud rate, we can accurately add a new "Low Pass Filter" in between the "AM Demod" and the "File Sink". The settings should be as follows:</p>

<ul>
<li>  Cutoff Freq = 4000 (roughly the Baud rate)</li>
</ul>



<ul>
<li>  Transition Width = 2000 (roughly half the Baud rate)</li>
</ul>

<p>Also, you may have noticed that the flow-graph has been running very slowly since we started demodulating the data. Let's try and work out why:</p>

<p>The sample rate is currently 4,000,000 and the Baud rate is 3600, so if we divide 4,000,000 by 3600 we get the number of samples per symbol - 1111! That's why it's running slowly... we don't need anywhere near 1111 samples to represent each bit.</p>

<p>In the "Low Pass Filter" set "FIR Type" to "Float-Float (Decimating)" and set "Decimation" to 10. This will decimate the signal (reduce the sample rate) by a factor of 10</p>

<p>Now re-run the flow-graph and load the resulting demodulated file into Baudline and the "Waveform view" should now look like this:</p>

<p><strong>Note: When you load the file back into Baudline don't forget that the sample rate has been decimated by 100 and is now, therefore, 40,000 instead of 4,000,000</strong></p>

<p><img src="images/ask_demod_filtered.png" alt=""></p>

<p>We're not quite ready to recover the bits yet though, as the signal should be alternating about 0dBm (the centre line in the waveform view. It's actually down towards -90dBm, so it needs to be increased.</p>

<p>Add an "Add Const" block in between the second "Low Pass Filter" and the "File Sink" and set the "Constant" value to be 0.45 (this value was determined through trial-and-error), to increase the signal level. The output should now look like this:</p>

<p><img src="images/ask_demod_filtered2.png" alt=""></p>

<h3>
<a id="data-recovery" class="anchor" href="#data-recovery" aria-hidden="true"><span class="octicon octicon-link"></span></a>Data recovery</h3>

<p>Now we are ready to recover the digital data. First we need to perform clock recovery - add a "Clock Recovery MM" block and set the following values:</p>

<ul>
<li>  "Gain Omega": 0.01</li>
</ul>



<ul>
<li>  "Mu": 0</li>
</ul>



<ul>
<li>  "Gain Mu": 0.1</li>
</ul>



<ul>
<li>  "Omega Relative Limit": 0.01</li>
</ul>

<p>The final value we need is "Omega" - this is the number of samples per symbol. We previously calculated this to be 1111.11 and so decimated the signal by a factor of 10 so "Omega" now needs to be set to 111.11 (1111.11 / 10).</p>

<p>Add a "Binary Slicer" to the output of the "Clock Recovery MM" block</p>

<p>Add a "File Sink" to the output of the "Binary Slicer" - you'll need to set the input type of the "File Sink" to "Byte" (pink coloured). Set the filename to be something like "bitfile"</p>

<p>Your final flow-graph should look something like this:</p>

<p><img src="images/ask_full_flowgraph.png" alt=""></p>

<p>Open up the "bitfile" file in a hex editor. Remember the preamble of "0101010101..."? You need to search for the preamble in the "bitfile", but if you look carefully, you can see that each byte in the file represents one bit i.e a "0" bit is represented by the byte "00" and a "1" bit is represented by the byte "01", so to search for the preamble you need to search for: "0001000100010001". The result of the search is shown below, the rest of the data follows the preamble:</p>

<p><img src="images/ask_hex_output.png" alt=""></p>

<p>You have now successfully retrieved the data from an ASK RF transmission!</p>

<h3>
<a id="communicating-with-the-receiver-in-real-time" class="anchor" href="#communicating-with-the-receiver-in-real-time" aria-hidden="true"><span class="octicon octicon-link"></span></a>Communicating with the receiver in real-time</h3>

<p>Rather than using a file as a sink you can use a "TCP Sink" block, bind it to a socket and receive data from it via TCP</p>

<h1>
<a id="transmitting-data" class="anchor" href="#transmitting-data" aria-hidden="true"><span class="octicon octicon-link"></span></a>Transmitting data</h1>

<p>&lt;span style="color:red"&gt; <strong>NOTE: Before transmitting any data, please fully read the <a href="https://wiki.pentest.ngs/index.php/RFTM#Legal_considerations">Legal considerations</a> section</strong> &lt;/span&gt;</p>

<h2>
<a id="rf-shielding-faraday-cages" class="anchor" href="#rf-shielding-faraday-cages" aria-hidden="true"><span class="octicon octicon-link"></span></a>RF shielding (Faraday cages)</h2>

<p>If you need to transmit signals on bands for which it would normally be illegal to do so e.g. Broadcast radio or 3G cellular then this can be performed within an RF-shielded environment. These come in all shapes and sizes, from small:</p>

<p><img src="images/rf_enclosure.png" alt=""></p>

<p>to large:</p>

<p><img src="images/screened_room.jpg" alt=""></p>

<h2>
<a id="direct-connection-using-attenuators" class="anchor" href="#direct-connection-using-attenuators" aria-hidden="true"><span class="octicon octicon-link"></span></a>Direct connection using attenuators</h2>

<p>Another approach is to directly connect your transmitter to your receiver via a cable so that no radio waves are transmitted. However, in order to do this without damaging the receiver you need to use in-line attenuators (see below) to reduce the signal level, as would occur if it was transmitted via an antenna</p>

<p><img src="images/attenuator.jpg" alt=""></p>

<h2>
<a id="developing-a-digital-fsk-transmitter-step-by-step" class="anchor" href="#developing-a-digital-fsk-transmitter-step-by-step" aria-hidden="true"><span class="octicon octicon-link"></span></a>Developing a digital (FSK) transmitter step-by-step</h2>

<p>If you have captured some data from a target system using a receiver and you now wish to modify that data and re-transmit it (for example if you are developing an RF-based fuzzer) the following process can be followed. This transmitter is assumed to use FSK modulation (this example is actually a transmitter developed for the <a href="https://wiki.pentest.ngs/index.php/Io-homecontrol">io-homecontrol protocol</a>)</p>

<h3>
<a id="data-source" class="anchor" href="#data-source" aria-hidden="true"><span class="octicon octicon-link"></span></a>Data source</h3>

<p>The assumption is that you start with a data file containing the binary data bytes you want to send</p>

<p>Create a new flow-graph and set the "samp_rate_tx" variable to 4e6</p>

<p><img src="images/tx_samp_rate.png" alt=""></p>

<p>Add a "File Source" block and set the file to be your data file. Ensure that "Repeat" is set to "No" (unless you specifically want it to repeat)</p>

<h3>
<a id="set-the-baud-rate" class="anchor" href="#set-the-baud-rate" aria-hidden="true"><span class="octicon octicon-link"></span></a>Set the Baud rate</h3>

<p>Having received the data, you should already know what the Baud rate should be set to. Add a new "Variable" block called "baud_rate" and set it to the correct value.</p>

<p><img src="images/tx_baud_rate.png" alt=""></p>

<h3>
<a id="modulation" class="anchor" href="#modulation" aria-hidden="true"><span class="octicon octicon-link"></span></a>Modulation</h3>

<p>Add a new "Variable" called "sps" (samples per symbol) and set it's value to be 10</p>

<p><img src="images/tx_sps.png" alt=""></p>

<p>Change the default "samp_rate" "Variable" block to 384000 (10 x Baud rate, as we want 10 samples per symbol)</p>

<p>Add a "GFSK Mod" block, which will modulate the data using FSK. Configure the following settings:</p>

<ul>
<li>  "Samples/Symbol": sps</li>
</ul>



<ul>
<li>  "Sensitivity": 1</li>
</ul>



<ul>
<li>  "BT": 1 (this will effectively remove the Gaussian filter and make it FSK rather than GFSK)</li>
</ul>

<p><img src="images/tx_gfsk_mod.png" alt=""></p>

<p>Your flow-graph should now look like this:</p>

<p><img src="images/tx_source_and_mod.png" alt=""></p>

<h3>
<a id="resampling" class="anchor" href="#resampling" aria-hidden="true"><span class="octicon octicon-link"></span></a>Resampling</h3>

<p>We now need to match the sample rate of the data with the transmitter (as it is the final sample rate of the transmitter that will actually determine the rate that the data is transmitted).</p>

<p>Add a "Rational Resampler" block with the following settings:</p>

<ul>
<li>  "Interpolation": samp_rate_tx (the output sample rate)</li>
</ul>



<ul>
<li>  "Decimation": samp_rate (the input sample rate)</li>
</ul>

<p><img src="images/tx_resampler.png" alt=""></p>

<h3>
<a id="adjust-the-signal-level" class="anchor" href="#adjust-the-signal-level" aria-hidden="true"><span class="octicon octicon-link"></span></a>Adjust the signal level</h3>

<p>We don't want to overload the input to the transmitter so we need to attenuate (reduce) the signal level.</p>

<p>Add a "Multiply Const" block and set "Constant" to be 0.8</p>

<p><img src="images/tx_const.png" alt=""></p>

<h3>
<a id="configure-the-transmitter" class="anchor" href="#configure-the-transmitter" aria-hidden="true"><span class="octicon octicon-link"></span></a>Configure the transmitter</h3>

<p>We are now ready to transmit the signal.</p>

<p>Add a "Variable" block with the name "freq" and value equal to the transmit frequency:</p>

<p><img src="images/tx_freq.png" alt=""></p>

<p>Add an "osmocom Sink" block with the following settings:</p>

<ul>
<li>  "Ch0: Frequency": freq</li>
</ul>



<ul>
<li>  "Ch0: RF Gain (dB)": 30 (can be changed as required)</li>
</ul>



<ul>
<li>  "Ch0: IF Gain (dB)": 20 (can be changed as required)</li>
</ul>



<ul>
<li>  "Ch0: BB Gain (dB)": 20 (can be changed as required)</li>
</ul>

<p><img src="images/tx_tx.png" alt=""></p>

<p>The complete transmitter flow-graph should now look like this:</p>

<p><img src="images/iohome_tx_crop.png" alt=""></p>

<h3>
<a id="communicating-with-the-transmitter-in-real-time" class="anchor" href="#communicating-with-the-transmitter-in-real-time" aria-hidden="true"><span class="octicon octicon-link"></span></a>Communicating with the transmitter in real-time</h3>

<p>Rather than using a file as a source you can use a "TCP Sink" block, bind it to a socket and send it data via TCP</p>

<h1>
<a id="signals-identification" class="anchor" href="#signals-identification" aria-hidden="true"><span class="octicon octicon-link"></span></a>Signals identification</h1>

<p>In order to correctly demodulate a received signal you need to be able to identify it first. This section will provide some guidance around identifying common signals.</p>

<p>This <a href="http://www.sigidwiki.com/wiki/Signal_Identification_Guide">website</a> is a good place to start.</p>

<h2>
<a id="amplitude-shift-keying-ask" class="anchor" href="#amplitude-shift-keying-ask" aria-hidden="true"><span class="octicon octicon-link"></span></a>Amplitude Shift Keying (ASK)</h2>

<p>The below example is the most simple form of ASK, known as On-Off Keying (OOK):</p>

<p><img src="images/ask_baudline.png" alt=""></p>

<h2>
<a id="frequency-shift-keying-fsk" class="anchor" href="#frequency-shift-keying-fsk" aria-hidden="true"><span class="octicon octicon-link"></span></a>Frequency Shift Keying (FSK)</h2>

<p>The below example is the most simple form of FSK, known as 2-FSK or Binary FSK:</p>

<p><img src="images/fsk_baudline.png" alt=""></p>

<p>TODO - add more stuff here</p>

<h1>
<a id="legal-considerations" class="anchor" href="#legal-considerations" aria-hidden="true"><span class="octicon octicon-link"></span></a>Legal considerations</h1>

<p>Unless you hold an <a href="http://licensing.ofcom.org.uk/radiocommunication-licences/amateur-radio/">Amateur Radio license</a> or have had specific training about UK law with respect to the areas of the radio frequency spectrum and at what power levels you are allowed to transmit, it is highly recommended that you restrict yourself to only receiving. The amateur radio license is fairly easy to get and a few people in the company seem to have them. Try emailing DL-Tech and you may find someone local who is willing to lend you training materials or point you in the direction of a local club.</p>

<p>A high level overview of UK law with respect to radio transmitters can be found <a href="http://stakeholders.ofcom.org.uk/enforcement/spectrum-enforcement/law">here</a></p>

<h1>
<a id="example-flow-graphs-and-tutorials" class="anchor" href="#example-flow-graphs-and-tutorials" aria-hidden="true"><span class="octicon octicon-link"></span></a>Example flow-graphs and tutorials</h1>

<h2>
<a id="simple-fm-radio-receiver" class="anchor" href="#simple-fm-radio-receiver" aria-hidden="true"><span class="octicon octicon-link"></span></a>Simple FM radio receiver</h2>
      </section>
    </div>

    <!-- FOOTER  -->
    <div id="footer_wrap" class="outer">
      <footer class="inner">
        <p class="copyright">RFTM maintained by <a href="https://github.com/nccgroup">nccgroup</a></p>
        <p>Published with <a href="http://pages.github.com">GitHub Pages</a></p>
      </footer>
    </div>

    

  </body>
</html>
